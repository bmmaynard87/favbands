{"version":3,"sources":["app.js","BandsController.js"],"names":[],"mappings":"AAAA;AACA;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["var app = angular.module('myApp', ['ui.bootstrap'])\r\n          .constant('API_URL', 'http://192.168.10.10/api/');","app.controller('BandsController', function($scope, $http, $filter, $timeout, $uibModal, API_URL) {\r\n    \r\n\t//Pull in all band records from API\r\n\tgetBands();\r\n\r\n\t//Show the add/edit form\r\n\t$scope.showForm = function(action, bandId) {\r\n        $scope.action = action;\r\n\r\n        if(bandId !== undefined) {\r\n            getBandById(bandId);\r\n            $scope.bandId = bandId;\r\n        }\r\n\r\n        var modalInstance = $uibModal.open({\r\n            templateUrl: 'bandModalTemplate.html',\r\n            controller: BandModalController,\r\n            scope: $scope,\r\n            resolve: {\r\n                bandForm: function() {\r\n                    return $scope.bandForm;\r\n                },\r\n                band: function() {\r\n                    return $scope.band;\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n\t$scope.deleteBand = function(id) {\r\n\t\tif(confirm(\"Are you sure you want to delete this band?\")) {\r\n\t\t\tdeleteBandById(id);\r\n\t\t}\r\n\t}\r\n\r\n\t//API functions\r\n\tfunction getBands() {\r\n\t\t$http.get(API_URL + 'bands')\r\n\t\t\t.then(function success(response) {\r\n\t\t\t\t$scope.bands = response.data;\r\n\t\t\t}, function failure(response) {\r\n\t\t\t\tconsole.log(response);\r\n\t\t\t});\r\n\t}\r\n\r\n\tfunction deleteBandById(id) {\r\n\t\t$http.delete(API_URL + 'bands/' + id)\r\n\t\t\t.then(function success(response) {\r\n\t\t\t\t//show response for 5 seconds\r\n\t\t\t\t$scope.message = response.data;\r\n\t\t\t\tgetBands();\r\n\r\n\t\t\t\t$timeout(function() {\r\n\t\t\t\t\t$scope.message = '';\r\n\t\t\t\t}, 5000);\r\n\t\t\t}, function failure(response) {\r\n\t\t\t\tconsole.log(response);\r\n\t\t\t\t\r\n\t\t\t\t$scope.message = \"We're having trouble deleting that record.\";\r\n\t\t\t});\r\n\t}\r\n\r\n\tfunction getBandById(id) {\r\n        $http.get(API_URL + 'bands/' + id)\r\n            .then(function success(response) {\r\n                var band = response.data;\r\n                band.still_active = band.still_active === 1;\r\n                band.start_date = $filter('date')(band.start_date, 'MM/dd/yyyy');\r\n\r\n                $scope.band = band;\r\n            }, function failure(response) {\r\n                console.log(response);\r\n            });\r\n    }\r\n    \r\n\t//Band Modal Controller\r\n\tvar BandModalController = function($scope, $rootScope, $uibModalInstance, band, bandForm) {\r\n        switch($scope.action) {\r\n            case 'add':\r\n                $scope.formTitle = 'Add New Band';\r\n                $scope.submitButtonLabel = 'Add';\r\n                $scope.submitAction = 'store';\r\n                $scope.band = null;\r\n                break;\r\n            case 'edit':\r\n                $scope.formTitle = 'Edit Band Details';\r\n                $scope.submitButtonLabel = 'Update';\r\n                $scope.submitAction = 'update';\r\n                break;\r\n        }\r\n\r\n        $scope.form = {};\r\n\r\n        $scope.close = function() {\r\n            $uibModalInstance.close('closed');\r\n        };\r\n\r\n        $scope.submitForm = function() {\r\n            if($scope.bandForm.$valid) {\r\n                //form valid\r\n                var url = null;\r\n\r\n                switch($scope.submitAction) {\r\n                    case 'store':\r\n                        url = API_URL + 'bands';\r\n                        var method = 'POST';\r\n                        break;\r\n                    case 'update':\r\n                        url = API_URL + 'bands/' + $scope.bandId;\r\n                        method = 'PUT';\r\n                        break;\r\n                }\r\n                \r\n                $http({\r\n                    method: method,\r\n                    url: url,\r\n                    transformRequest: function(obj) {\r\n                        var str = [];\r\n                        for(var p in obj)\r\n                            str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\r\n                        return str.join(\"&\");\r\n                    },\r\n                    data: {\r\n                        name: $scope.band.name,\r\n                        start_date: $scope.band.start_date !== undefined && $scope.band.start_date !== null && angular.isDate(new Date($scope.band.start_date)) ? $scope.band.start_date : '0000-00-00',\r\n                        website: $scope.band.website !== undefined && isValidUrl($scope.band.website) ? $scope.band.website : '',\r\n                        still_active: $scope.band.still_active ? 1 : 0\r\n                    },\r\n                    headers: {'Content-Type': 'application/x-www-form-urlencoded'}\r\n                }).then(function success(response) {\r\n                    getBands();\r\n                    console.log(response.data);\r\n                    \r\n                    //show response for 5 seconds\r\n                    $rootScope.message = response.data;\r\n                    \r\n                    $timeout(function() {\r\n                    \t$rootScope.message = '';\r\n                    }, 5000);\r\n                }, function failure(response) {\r\n                    console.log(response);\r\n                    alert(\"Sorry, looks like there was an error.\");\r\n                });\r\n\r\n                $uibModalInstance.close('closed');\r\n            }\r\n        };\r\n    };\r\n\r\n\tfunction isValidUrl(str) {\r\n\t\tvar pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol\r\n    \t'((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|'+ // domain name\r\n    \t'((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))'+ // OR ip (v4) address\r\n    \t'(\\\\:\\\\d+)?(\\/[-a-z\\\\d%_.~+]*)*'+ // port and path\r\n    \t'(\\\\?[;&a-z\\\\d%_.~+=-]*)?'+ // query string\r\n    \t'(\\\\#[-a-z\\\\d_]*)?$','i'); // fragment locater\r\n    \tif(!pattern.test(str)) {\r\n    \t\treturn false;\r\n  \t\t} else {\r\n    \t\treturn true;\r\n  \t\t}\r\n\t}\r\n\r\n});"]}